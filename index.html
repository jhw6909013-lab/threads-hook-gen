<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threads 爆款鉤子生成器 // PROTOCOL: HOOK</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Generative AI SDK -->
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        body { font-family: 'Share Tech Mono', monospace; }
        .cyber-border { border: 1px solid #34d399; box-shadow: 0 0 10px #34d399; }
        .cyber-input { background: rgba(0, 20, 0, 0.8); border: 1px solid #065f46; color: #34d399; }
        .cyber-input:focus { outline: none; border-color: #34d399; box-shadow: 0 0 5px #34d399; }
        .loading-scan {
            width: 100%; height: 2px; background: #064e3b; position: relative; overflow: hidden;
        }
        .loading-scan::after {
            content: ''; position: absolute; top: 0; left: 0; height: 100%; width: 50%;
            background: #34d399; animation: scan 1s infinite linear;
        }
        @keyframes scan { 0% { left: -50%; } 100% { left: 100%; } }
    </style>
</head>
<body class="bg-gray-900 text-green-400 min-h-screen flex items-center justify-center p-4 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">

    <div class="max-w-md w-full bg-black bg-opacity-90 p-6 rounded-lg cyber-border relative">
        <!-- 裝飾元素 -->
        <div class="absolute top-0 left-0 w-2 h-2 bg-green-500"></div>
        <div class="absolute top-0 right-0 w-2 h-2 bg-green-500"></div>
        <div class="absolute bottom-0 left-0 w-2 h-2 bg-green-500"></div>
        <div class="absolute bottom-0 right-0 w-2 h-2 bg-green-500"></div>

        <h1 class="text-2xl font-bold text-center mb-2 tracking-widest text-green-300">VIRAL HOOK GEN</h1>
        <p class="text-xs text-center text-green-700 mb-6">SYSTEM STATUS: ONLINE // PETAPI-LINKED</p>

        <!-- 輸入區 -->
        <div class="space-y-4">
            <div>
                <label class="block text-xs mb-1 opacity-70">TARGET TOPIC [輸入主題]</label>
                <input type="text" id="topicInput" placeholder="例如：AI變現、職場生存、拒絕內耗" class="w-full p-2 rounded cyber-input">
            </div>

            <div>
                <label class="block text-xs mb-1 opacity-70">TONE MODE [語氣選擇]</label>
                <select id="toneSelect" class="w-full p-2 rounded cyber-input">
                    <option value="懸疑">懸疑 (Suspense)</option>
                    <option value="毒舌">毒舌 (Savage)</option>
                    <option value="溫暖">溫暖 (Warm)</option>
                    <option value="爭議">爭議 (Controversial)</option>
                    <option value="教學">乾貨 (Educational)</option>
                </select>
            </div>

            <button id="generateBtn" class="w-full bg-green-900 hover:bg-green-700 text-green-300 border border-green-500 p-2 rounded font-bold transition-all duration-200 uppercase tracking-widest hover:shadow-[0_0_15px_#34d399]">
                INITIATE GENERATION
            </button>
        </div>

        <!-- 讀取條 -->
        <div id="loadingBar" class="hidden mt-4">
            <p class="text-xs text-center mb-1 animate-pulse">PROCESSING DATA...</p>
            <div class="loading-scan"></div>
        </div>

        <!-- 輸出區 -->
        <div id="outputArea" class="mt-6 space-y-3 hidden">
            <!-- 結果會動態插入這裡 -->
        </div>
        
        <!-- 底部版權/導購 -->
        <div class="mt-8 pt-4 border-t border-green-900 text-center text-xs text-green-600">
            <p>POWERED BY GEMINI-1.5-FLASH</p>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // ✅ 您的 PETAPI 新 Key 已正確填入
        const API_KEY = 'AIzaSyB7x6ApY35Bq1tnyYren00YoJNtTgf3thY'; 

        const genAI = new GoogleGenerativeAI(API_KEY);
        
        // 使用 gemini-1.5-flash，這是目前的主力模型
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

        const generateBtn = document.getElementById('generateBtn');
        const topicInput = document.getElementById('topicInput');
        const toneSelect = document.getElementById('toneSelect');
        const outputArea = document.getElementById('outputArea');
        const loadingBar = document.getElementById('loadingBar');

        generateBtn.addEventListener('click', async () => {
            const topic = topicInput.value.trim();
            const tone = toneSelect.value;

            if (!topic) {
                alert('⚠️ ERROR: 請輸入主題');
                return;
            }

            // UI 狀態切換
            loadingBar.classList.remove('hidden');
            outputArea.classList.add('hidden');
            outputArea.innerHTML = '';
            generateBtn.disabled = true;
            generateBtn.innerText = "CALCULATING...";

            try {
                const prompt = `你是一個 Threads 社交平台爆款文案專家。
                請針對主題「${topic}」，用「${tone}」的語氣，生成 3 個極具吸引力、讓人忍不住點開全文的「第一句話」(Hook)。
                
                要求：
                1. 繁體中文（台灣用語）。
                2. 簡短有力，不超過 40 字。
                3. 有話顯得沒說完，或者反常識，引發好奇心。
                4. 直接給我 3 個句子，每句一行，不要有 1. 2. 3. 編號，不要有引號。`;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();
                
                // 處理回傳文字
                const hooks = text.split('\n').filter(line => line.trim() !== '');

                renderHooks(hooks);

            } catch (error) {
                console.error("API Error:", error);
                
                outputArea.innerHTML = `
                    <div class="text-red-500 border border-red-500 p-2 text-center text-xs">
                        SYSTEM FAILURE: ${error.message}<br>
                        (連線錯誤，請確認網路狀態)
                    </div>`;
                outputArea.classList.remove('hidden');
            } finally {
                loadingBar.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.innerText = "INITIATE GENERATION";
            }
        });

        function renderHooks(hooks) {
            outputArea.classList.remove('hidden');
            hooks.slice(0, 3).forEach(hook => {
                const div = document.createElement('div');
                div.className = "bg-green-900 bg-opacity-20 border border-green-800 p-3 rounded flex justify-between items-center group hover:bg-opacity-40 transition-all";
                
                div.innerHTML = `
                    <span class="text-sm flex-1 mr-2 tracking-wide">${hook}</span>
                    <button class="copy-btn text-xs bg-black border border-green-600 px-2 py-1 rounded hover:bg-green-600 hover:text-black transition-colors" onclick="copyToClipboard(this, '${hook.replace(/'/g, "\\'")}')">
                        COPY
                    </button>
                `;
                outputArea.appendChild(div);
            });
        }

        // 全域函數供 HTML onclick 使用
        window.copyToClipboard = (btn, text) => {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = btn.innerText;
                btn.innerText = "COPIED!";
                btn.classList.add('bg-green-500', 'text-black');
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('bg-green-500', 'text-black');
                }, 2000);
            });
        }
    </script>
</body>
</html>
