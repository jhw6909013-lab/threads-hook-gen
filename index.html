<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threads çˆ†æ¬¾é‰¤å­ç”Ÿæˆå™¨ // PROTOCOL: AUTO-DISCOVERY</title>
    <!-- CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        body { font-family: 'Share Tech Mono', monospace; }
        .cyber-border { border: 1px solid #34d399; box-shadow: 0 0 10px #34d399; }
        .cyber-input { background: rgba(0, 20, 0, 0.8); border: 1px solid #065f46; color: #34d399; }
        .cyber-input:focus { outline: none; border-color: #34d399; box-shadow: 0 0 5px #34d399; }
        .loading-scan { width: 100%; height: 2px; background: #064e3b; position: relative; overflow: hidden; }
        .loading-scan::after { content: ''; position: absolute; top: 0; left: 0; height: 100%; width: 50%; background: #34d399; animation: scan 1s infinite linear; }
        @keyframes scan { 0% { left: -50%; } 100% { left: 100%; } }
    </style>
</head>
<body class="bg-gray-900 text-green-400 min-h-screen flex items-center justify-center p-4 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">

    <div class="max-w-md w-full bg-black bg-opacity-90 p-6 rounded-lg cyber-border relative z-0">
        <h1 class="text-2xl font-bold text-center mb-2 tracking-widest text-green-300">VIRAL HOOK GEN</h1>
        <p class="text-xs text-center text-green-700 mb-6">SYSTEM STATUS: AUTO-DISCOVERY // VER 10.0</p>

        <div class="space-y-4">
            <div>
                <label class="block text-xs mb-1 opacity-70">TARGET TOPIC [è¼¸å…¥ä¸»é¡Œ]</label>
                <input type="text" id="topicInput" placeholder="ä¾‹å¦‚ï¼šAIè®Šç¾ã€æ‹’çµ•å…§è€—" class="w-full p-2 rounded cyber-input relative z-10">
            </div>
            <div>
                <label class="block text-xs mb-1 opacity-70">TONE MODE [èªæ°£é¸æ“‡]</label>
                <select id="toneSelect" class="w-full p-2 rounded cyber-input relative z-10">
                    <option value="æ‡¸ç–‘">æ‡¸ç–‘ (Suspense)</option>
                    <option value="æ¯’èˆŒ">æ¯’èˆŒ (Savage)</option>
                    <option value="æº«æš–">æº«æš– (Warm)</option>
                    <option value="çˆ­è­°">çˆ­è­° (Controversial)</option>
                </select>
            </div>
            
            <button id="generateBtn" onclick="fireNow()" class="relative z-50 w-full bg-green-900 hover:bg-green-700 text-green-300 border border-green-500 p-2 rounded font-bold transition-all duration-200 uppercase tracking-widest hover:shadow-[0_0_15px_#34d399] cursor-pointer">
                INITIATE GENERATION
            </button>
        </div>

        <div id="loadingBar" class="hidden mt-4 relative z-10">
            <p id="loadingText" class="text-xs text-center mb-1 animate-pulse">SEARCHING FOR AVAILABLE MODELS...</p>
            <div class="loading-scan"></div>
        </div>
        <div id="outputArea" class="mt-6 space-y-3 hidden relative z-10"></div>
        
        <div class="mt-8 pt-4 border-t border-green-900 text-center text-xs text-green-600 relative z-10">
            <p id="modelInfoText">WAITING FOR COMMAND</p>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyBfxZMyvRbEJN-OcvHRg0OpvkbDhEAruRU'; 
        
        // ğŸ” è‡ªå‹•åµæŸ¥åŠŸèƒ½ï¼šæ‰¾å‡ºå¸³è™Ÿè£¡åˆ°åº•æœ‰å“ªäº›æ¨¡å‹æ˜¯æ´»è‘—çš„
        async function findWorkingModel() {
            try {
                const listUrl = `https://generativelanguage.googleapis.com/v1beta/models?key=${API_KEY}`;
                const response = await fetch(listUrl);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error?.message || "ç„¡æ³•å–å¾—æ¨¡å‹åˆ—è¡¨");
                }

                if (!data.models) {
                    throw new Error("æ‚¨çš„å¸³è™Ÿé›–ç„¶é–‹å•Ÿäº† APIï¼Œä½†æ¨¡å‹åˆ—è¡¨æ˜¯ç©ºçš„ (Empty Inventory)ã€‚");
                }

                // ç¯©é¸å‡ºæ”¯æ´ 'generateContent' çš„æ¨¡å‹
                const viableModel = data.models.find(m => 
                    m.supportedGenerationMethods && 
                    m.supportedGenerationMethods.includes("generateContent") &&
                    (m.name.includes("gemini") || m.name.includes("flash") || m.name.includes("pro"))
                );

                if (viableModel) {
                    // æ‰¾åˆ°äº†ï¼å›å‚³æ¨¡å‹åç¨± (æŠŠå‰é¢çš„ models/ å»æ‰ï¼Œæˆ–è€…ä¿ç•™ï¼Œè¦– API éœ€æ±‚)
                    // Google API é€šå¸¸éœ€è¦å®Œæ•´çš„ models/gemini-xxx
                    return viableModel.name; 
                } else {
                    throw new Error("æ‰¾ä¸åˆ°ä»»ä½•æ”¯æ´æ–‡å­—ç”Ÿæˆçš„ Gemini æ¨¡å‹ã€‚");
                }

            } catch (e) {
                console.error("Auto-discovery failed:", e);
                // å¦‚æœåµæŸ¥å¤±æ•—ï¼Œé‚„æ˜¯å›å‚³ä¸€å€‹å‚™ç”¨çš„
                return "models/gemini-1.5-flash"; 
            }
        }

        async function fireNow() {
            const generateBtn = document.getElementById('generateBtn');
            const topicInput = document.getElementById('topicInput');
            const toneSelect = document.getElementById('toneSelect');
            const outputArea = document.getElementById('outputArea');
            const loadingBar = document.getElementById('loadingBar');
            const loadingText = document.getElementById('loadingText');
            const modelInfoText = document.getElementById('modelInfoText');

            const topic = topicInput.value.trim();
            const tone = toneSelect.value;

            if (!topic) {
                alert('âš ï¸ ERROR: è«‹è¼¸å…¥ä¸»é¡Œ');
                return;
            }

            loadingBar.classList.remove('hidden');
            outputArea.classList.add('hidden');
            outputArea.innerHTML = '';
            generateBtn.disabled = true;
            generateBtn.innerText = "SCANNING...";

            try {
                // 1. å…ˆæ‰¾å‡ºå¯ç”¨æ¨¡å‹
                loadingText.innerText = "AUTO-DETECTING MODELS...";
                let modelName = await findWorkingModel();
                
                // ä¿®æ­£æ¨¡å‹åç¨±æ ¼å¼ (æœ‰äº›å›å‚³å¸¶æœ‰ models/ æœ‰äº›æ²’æœ‰ï¼Œçµ±ä¸€è™•ç†)
                if (!modelName.startsWith("models/")) {
                    modelName = `models/${modelName}`;
                }
                
                console.log(`ğŸ¯ Locked on target: ${modelName}`);
                modelInfoText.innerText = `LOCKED: ${modelName.replace('models/', '').toUpperCase()}`;
                
                loadingText.innerText = "GENERATING CONTENT...";
                generateBtn.innerText = "GENERATING...";

                // 2. ä½¿ç”¨è©²æ¨¡å‹ç™¼å°„
                const prompt = `ä½ æ˜¯ä¸€å€‹Threadsçˆ†æ¬¾æ–‡æ¡ˆå°ˆå®¶ã€‚è«‹é‡å°ä¸»é¡Œã€Œ${topic}ã€ï¼Œç”¨ã€Œ${tone}ã€çš„èªæ°£ï¼Œç”Ÿæˆ 3 å€‹æ¥µå…·å¸å¼•åŠ›ã€è®“äººå¿ä¸ä½é»é–‹å…¨æ–‡çš„ã€Œç¬¬ä¸€å¥è©±ã€(Hook)ã€‚ç¹é«”ä¸­æ–‡ï¼Œä¸è¶…é40å­—ï¼Œåå¸¸è­˜ã€‚ç›´æ¥çµ¦3å¥ï¼Œä¸è¦ç·¨è™Ÿã€‚`;
                
                const url = `https://generativelanguage.googleapis.com/v1beta/${modelName}:generateContent?key=${API_KEY}`;
                
                const data = {
                    contents: [{
                        parts: [{ text: prompt }]
                    }]
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const json = await response.json();

                if (!response.ok) {
                    let msg = json.error?.message || "Unknown Error";
                    if (msg.includes("404")) throw new Error(`æ¨¡å‹ ${modelName} å›å ± 404 (ä¸å¯ç”¨)ã€‚é€™ä»£è¡¨å¸³è™Ÿç•°å¸¸ã€‚`);
                    throw new Error(msg);
                }

                let text = "";
                if (json.candidates && json.candidates[0] && json.candidates[0].content) {
                    text = json.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("æ¨¡å‹å·²å›æ‡‰ä½†å…§å®¹ç‚ºç©ºã€‚");
                }

                const hooks = text.split('\n').filter(line => line.trim() !== '');

                outputArea.classList.remove('hidden');
                hooks.slice(0, 3).forEach(hook => {
                    const div = document.createElement('div');
                    div.className = "bg-green-900 bg-opacity-20 border border-green-800 p-3 rounded flex justify-between items-center";
                    div.innerHTML = `<span class="text-sm flex-1 mr-2 tracking-wide">${hook}</span><button class="text-xs bg-black border border-green-600 px-2 py-1 rounded hover:bg-green-600 hover:text-black transition-colors" onclick="navigator.clipboard.writeText('${hook.replace(/'/g, "\\'")}')">COPY</button>`;
                    outputArea.appendChild(div);
                });

            } catch (error) {
                console.error(error);
                outputArea.classList.remove('hidden');
                outputArea.innerHTML = `<div class="text-red-500 text-center text-xs p-2 border border-red-500">
                    ğŸ’¥ åš´é‡éŒ¯èª¤ï¼š${error.message}<br>
                    (è‹¥é€£è‡ªå‹•åµæ¸¬éƒ½å¤±æ•—ï¼Œä»£è¡¨æ­¤ Google Cloud Project å¸³è™Ÿå®Œå…¨æ²’æœ‰æ¨¡å‹ä½¿ç”¨æ¬Šï¼Œå»ºè­°æ”¾æ£„æ­¤å°ˆæ¡ˆï¼Œå€Ÿç”¨åˆ¥äººçš„ Key æˆ–ç­‰å¾… 24 å°æ™‚å¾Œé‡è©¦ã€‚)
                </div>`;
            } finally {
                loadingBar.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.innerText = "INITIATE GENERATION";
            }
        }
    </script>
</body>
</html>
